#! /usr/bin/env python
## 
## Demonstrate Hekateros' capabilities by executing a canned trajectory motion
##

import roslib; roslib.load_manifest('hekateros_control')
import rospy

import actionlib
import control_msgs.msg
import trajectory_msgs.msg

def hek_demo():
    client = actionlib.SimpleActionClient( 
            'hekateros_control/follow_joint_traj_as', 
            control_msgs.msg.FollowJointTrajectoryAction)

    print "Waiting for action server"
    client.wait_for_server()
    print "Connected"

    joint_traj = trajectory_msgs.msg.JointTrajectory()

    joint_traj.joint_names.insert(0,'grip')
    joint_traj.joint_names.insert(1,'wrist_rot')
    joint_traj.joint_names.insert(2,'wrist_pitch')

    jtp1 = trajectory_msgs.msg.JointTrajectoryPoint()
    jtp1.positions.insert(0,0.4); jtp1.velocities.insert(0,10)
    jtp1.positions.insert(1,3.2); jtp1.velocities.insert(1, 100)
    jtp1.positions.insert(2,1.5); jtp1.velocities.insert(2, 100)

    jtp2 = trajectory_msgs.msg.JointTrajectoryPoint()
    jtp2.positions.insert(0,0.9); jtp2.velocities.insert(0,10)
    jtp2.positions.insert(1,-3.2); jtp2.velocities.insert(1, 100)
    jtp2.positions.insert(2,-1.5); jtp2.velocities.insert(2, 100)
    
    jtp3 = trajectory_msgs.msg.JointTrajectoryPoint()
    jtp3.positions.insert(0,0.0); jtp3.velocities.insert(0,10)
    jtp3.positions.insert(1,0.0); jtp3.velocities.insert(1, 100)
    jtp3.positions.insert(2,0.0); jtp3.velocities.insert(2, 100)

    jtp4 = trajectory_msgs.msg.JointTrajectoryPoint()
    jtp4.positions.insert(0,0.4); jtp4.velocities.insert(0,5)
    jtp4.positions.insert(1,0.0); jtp4.velocities.insert(1, 100)
    jtp4.positions.insert(2,0.0); jtp4.velocities.insert(2, 100)

    jtp5 = trajectory_msgs.msg.JointTrajectoryPoint()
    jtp5.positions.insert(0,0.0); jtp5.velocities.insert(0,5)
    jtp5.positions.insert(1,0.0); jtp5.velocities.insert(1, 100)
    jtp5.positions.insert(2,0.0); jtp5.velocities.insert(2, 100)

    joint_traj.points.insert(0,jtp1)
    joint_traj.points.insert(1,jtp2)
    joint_traj.points.insert(2,jtp3)
    joint_traj.points.insert(3,jtp4)
    joint_traj.points.insert(4,jtp5)

    goal = control_msgs.msg.FollowJointTrajectoryGoal()
    goal.trajectory = joint_traj

    # Sends the goal to the action server.
    print "Sending FollowJointTrajectoryGoal"
    client.send_goal(goal)

    # Waits for the server to finish performing the action.
    print "Waiting for result"
    client.wait_for_result()
    print "Done!"

    # Prints out the result of executing the action
    return client.get_result()

if __name__ == '__main__':
    try:
        rospy.init_node('joint_traj_client')
        result = hek_demo()

    except rospy.ROSInterruptException:
        print "program interrupted before completion"
